generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

//
// ENUMS
//

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum MatchStatus {
  PENDING
  ACCEPTED
  REJECTED
  BLOCKED
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  INACTIVE
}

//
// MODELS
//


model User {
  id          String        @id @default(cuid())
  name        String?
  email       String        @unique
  password    String
  image       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  profile         Profile?
  photos          Photo[]
  messagesSent    Message[]      @relation("SentMessages")
  messagesReceived Message[]     @relation("ReceivedMessages")
  matchesInitiated Match[]       @relation("MatchInitiator")
  matchesReceived  Match[]       @relation("MatchReceiver")
  subscription     Subscription?
}

model Profile {
  id          String @id @default(cuid())
  userId      String @unique
  user        User   @relation(fields: [userId], references: [id])

  bio         String?
  age         Int?
  gender      Gender?
  location    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Photo {
  id        String   @id @default(cuid())
  userId    String
  url       String
  createdAt DateTime @default(now())

  user      User @relation(fields: [userId], references: [id])
}


model Message {
  id          String   @id @default(cuid())
  senderId    String
  receiverId  String
  content     String
  createdAt   DateTime @default(now())

  sender      User @relation("SentMessages", fields: [senderId], references: [id])
  receiver    User @relation("ReceivedMessages", fields: [receiverId], references: [id])
}

model Match {
  id          String   @id @default(cuid())
  initiatorId String
  receiverId  String
  status      MatchStatus @default(PENDING)
  createdAt   DateTime @default(now())

  initiator   User @relation("MatchInitiator", fields: [initiatorId], references: [id])
  receiver    User @relation("MatchReceiver", fields: [receiverId], references: [id])
}


model Subscription {
  id            String              @id @default(cuid())
  userId        String              @unique
  stripeSubId   String?
  stripePriceId String?
  status        SubscriptionStatus  @default(INACTIVE)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  user          User @relation(fields: [userId], references: [id])
}
